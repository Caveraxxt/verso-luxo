<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Verso Luxo - Gest√£o Sincronizada</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:20px; }
    h1, h2 { color:#111; }
    .card { background:#fff; padding:16px; margin-bottom:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    input, button { padding:10px; margin:6px 0; width:100%; font-size:16px; }
    button { background:#111; color:#fff; border:none; cursor:pointer; }
    table { width:100%; border-collapse: collapse; margin-top:10px; }
    th, td { border-bottom:1px solid #ddd; padding:8px; font-size:14px; }
    #app { display:none; }
  </style>
</head>
<body>

<div class="card" id="login">
  <h2>üîê Acesso Restrito ‚Äì Verso Luxo</h2>
  <input id="senha" type="password" placeholder="Digite a senha" />
  <button onclick="login()">Entrar</button>
</div>

<div id="app">
<h1>Verso Luxo ‚Äì Gest√£o Sincronizada</h1>

<div class="card">
  <h2>Cadastro de Produto</h2>
  <input id="nome" placeholder="Nome do produto" />
  <input id="compra" type="number" placeholder="Pre√ßo de compra" />
  <input id="venda" type="number" placeholder="Pre√ßo de venda" />
  <input id="estoque" type="number" placeholder="Estoque inicial" />
  <button id="btnAdd">Adicionar Produto</button>
</div>

<div class="card">
  <h2>Estoque e Vendas</h2>
  <table>
    <thead>
      <tr><th>Produto</th><th>Compra</th><th>Venda</th><th>Estoque</th><th>A√ß√£o</th></tr>
    </thead>
    <tbody id="lista"></tbody>
  </table>
  <button onclick="estornarVenda()">Estornar √∫ltima venda</button>
</div>

<div class="card">
  <h2>Resumo Financeiro</h2>
  <p id="saldo"></p>
  <p id="custo"></p>
  <p id="lucro"></p>
</div>

<div class="card">
  <h2>Divis√£o de Lucros</h2>
  <ul id="divisao"></ul>
</div>

<div class="card">
  <h2>Hist√≥rico de Vendas</h2>
  <table>
    <thead>
      <tr><th>Data</th><th>Produto</th><th>Venda</th><th>Custo</th><th>Lucro</th></tr>
    </thead>
    <tbody id="historico"></tbody>
  </table>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

// ===== FIREBASE =====
const firebaseConfig = {
  apiKey: "AIzaSyAdz_ARwuY1uFGS9jiE_C_xhBULgez0lco",
  authDomain: "verso-luxo.firebaseapp.com",
  projectId: "verso-luxo",
  storageBucket: "verso-luxo.firebasestorage.app",
  messagingSenderId: "280590041922",
  appId: "1:280590041922:web:2963525e25fb360aea7edb"
};

const appFirebase = initializeApp(firebaseConfig);
const db = getFirestore(appFirebase);
const lojaRef = doc(db, 'loja', 'principal');

// ===== SENHA =====
const SENHA_CORRETA = 'versoluxo123';

// ===== DOM =====
const senhaInput = document.getElementById('senha');
const nomeInput = document.getElementById('nome');
const compraInput = document.getElementById('compra');
const vendaInput = document.getElementById('venda');
const estoqueInput = document.getElementById('estoque');
const lista = document.getElementById('lista');
const historico = document.getElementById('historico');
const saldo = document.getElementById('saldo');
const custo = document.getElementById('custo');
const lucro = document.getElementById('lucro');
const divisao = document.getElementById('divisao');

// ===== ESTADO =====
let produtos = [];
let vendas = [];
let saldoLoja = 0;
let custoTotal = 0;
let lucroTotal = 0;

// ===== LOGIN =====
window.login = async function () {
  if (senhaInput.value !== SENHA_CORRETA) {
    alert('Senha incorreta');
    return;
  }
  document.getElementById('login').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  await iniciarSync();
};

// ===== SYNC =====
async function iniciarSync() {
  const snap = await getDoc(lojaRef);
  if (!snap.exists()) {
    await setDoc(lojaRef, {
      produtos: [],
      vendas: [],
      saldoLoja: 0,
      custoTotal: 0,
      lucroTotal: 0
    });
  }

  onSnapshot(lojaRef, (docSnap) => {
    const d = docSnap.data();
    produtos = d.produtos || [];
    vendas = d.vendas || [];
    saldoLoja = d.saldoLoja || 0;
    custoTotal = d.custoTotal || 0;
    lucroTotal = d.lucroTotal || 0;
    render();
  });
}

async function salvar() {
  await setDoc(lojaRef, {
    produtos,
    vendas,
    saldoLoja,
    custoTotal,
    lucroTotal
  });
}

// ===== A√á√ïES =====
window.addProduto = async function () {
  const nome = nomeInput.value.trim();
  const compra = Number(compraInput.value);
  const venda = Number(vendaInput.value);
  const estoque = Number(estoqueInput.value);

  if (!nome || compra <= 0 || venda <= 0 || estoque < 0) {
    alert('Preencha todos os campos corretamente');
    return;
  }

  produtos.push({ nome, compra, venda, estoque });

  nomeInput.value = '';
  compraInput.value = '';
  vendaInput.value = '';
  estoqueInput.value = '';

  await salvar();
};

window.vender = async function (i) {
  if (produtos[i].estoque <= 0) return alert('Sem estoque');

  produtos[i].estoque--;
  const custoItem = produtos[i].compra;
  const valorVenda = produtos[i].venda;
  const lucroItem = valorVenda - custoItem;

  saldoLoja += valorVenda;
  custoTotal += custoItem;
  lucroTotal += lucroItem;

  vendas.push({
    data: new Date().toLocaleString(),
    nome: produtos[i].nome,
    valorVenda,
    custo: custoItem,
    lucro: lucroItem,
    produtoIndex: i
  });

  await salvar();
};

window.estornarVenda = async function () {
  if (vendas.length === 0) return alert('Nada para estornar');

  const v = vendas.pop();
  if (produtos[v.produtoIndex]) {
    produtos[v.produtoIndex].estoque++;
  }
  saldoLoja -= v.valorVenda;
  custoTotal -= v.custo;
  lucroTotal -= v.lucro;

  await salvar();
};

window.removerProduto = async function (i) {
  const p = produtos[i];
  const confirmar = confirm(`Deseja remover o produto "${p.nome}"?

‚ö†Ô∏è Isso n√£o apaga vendas antigas.`);
  if (!confirmar) return;

  produtos.splice(i, 1);
  await salvar();
};

// ===== RENDER =====
function render() {
  lista.innerHTML = '';
  produtos.forEach((p, i) => {
    lista.innerHTML += `<tr>
      <td>
<button onclick="vender(${i})">Vender</button>
<button onclick="removerProduto(${i})" style="margin-left:5px;background:#c0392b;color:#fff;">Remover</button>
</td>
    </tr>`;
  });

  historico.innerHTML = '';
  vendas.forEach(v => {
    historico.innerHTML += `<tr>
      <td>${v.data}</td>
      <td>${v.nome}</td>
      <td>R$ ${v.valorVenda.toFixed(2)}</td>
      <td>R$ ${v.custo.toFixed(2)}</td>
      <td>R$ ${v.lucro.toFixed(2)}</td>
    </tr>`;
  });

  saldo.innerText = `Saldo da loja: R$ ${saldoLoja.toFixed(2)}`;
  custo.innerText = `Custo total: R$ ${custoTotal.toFixed(2)}`;
  lucro.innerText = `Lucro total: R$ ${lucroTotal.toFixed(2)}`;

  divisao.innerHTML = '';
  const partes = [33, 33, 16.5, 16.5];
  const nomes = ['Caixa da Empresa', 'Reinvestimento', 'Bruno', 'Pedro'];
  partes.forEach((p, i) => {
    divisao.innerHTML += `<li>${nomes[i]}: R$ ${(lucroTotal * (p / 100)).toFixed(2)}</li>`;
  });
}

// bot√£o
const btnAdd = document.getElementById('btnAdd');
btnAdd.addEventListener('click', addProduto);
</script>
</body>
</html>
