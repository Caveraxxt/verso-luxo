<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Verso Luxo - Gest√£o</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; margin:0; }
h1,h2 { color:#111; }
.card { background:#fff; padding:16px; margin-bottom:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.1); }
input,button { width:100%; padding:10px; margin:6px 0; font-size:16px; }
button { background:#111; color:#fff; border:none; cursor:pointer; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th,td { border-bottom:1px solid #ddd; padding:8px; text-align:center; font-size:14px; }
#app { display:none; }
.remover { background:#c0392b; margin-left:5px; }
</style>
</head>

<body>

<div class="card" id="login">
  <h2>üîê Acesso Restrito ‚Äì Verso Luxo</h2>
  <input id="senha" type="password" placeholder="Senha √∫nica">
  <button onclick="login()">Entrar</button>
</div>

<div id="app">

<h1>Verso Luxo ‚Äì Gest√£o Sincronizada</h1>

<div class="card">
  <h2>Cadastro de Produto</h2>
  <input id="nome" placeholder="Nome do produto">
  <input id="compra" type="number" placeholder="Pre√ßo de compra">
  <input id="venda" type="number" placeholder="Pre√ßo de venda">
  <input id="estoque" type="number" placeholder="Estoque inicial">
  <button id="btnAdd">Adicionar Produto</button>
</div>

<div class="card">
  <h2>Estoque e Vendas</h2>
  <table>
    <thead>
      <tr>
        <th>Produto</th>
        <th>Compra</th>
        <th>Venda</th>
        <th>Estoque</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="lista"></tbody>
  </table>
  <button onclick="estornarVenda()">Estornar √∫ltima venda</button>
</div>

<div class="card">
  <h2>Resumo Financeiro</h2>
  <p id="saldo"></p>
  <p id="custo"></p>
  <p id="lucro"></p>
</div>

<div class="card">
  <h2>Divis√£o de Lucros</h2>
  <ul id="divisao"></ul>
</div>

<div class="card">
  <h2>Hist√≥rico de Vendas</h2>
  <table>
    <thead>
      <tr>
        <th>Data</th>
        <th>Produto</th>
        <th>Venda</th>
        <th>Custo</th>
        <th>Lucro</th>
      </tr>
    </thead>
    <tbody id="historico"></tbody>
  </table>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

// üî• Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAdz_ARwuY1uFGS9jiE_C_xhBULgez0lco",
  authDomain: "verso-luxo.firebaseapp.com",
  projectId: "verso-luxo",
  storageBucket: "verso-luxo.firebasestorage.app",
  messagingSenderId: "280590041922",
  appId: "1:280590041922:web:2963525e25fb360aea7edb"
};

const appFirebase = initializeApp(firebaseConfig);
const db = getFirestore(appFirebase);
const lojaRef = doc(db, "loja", "principal");

// üîê Senha
const SENHA_CORRETA = "versoluxo123";

// üì¶ Estado
let produtos = [];
let vendas = [];
let saldoLoja = 0;
let custoTotal = 0;
let lucroTotal = 0;

// üîê Login
window.login = async () => {
  if (document.getElementById("senha").value !== SENHA_CORRETA) {
    alert("Senha incorreta");
    return;
  }
  document.getElementById("login").style.display = "none";
  document.getElementById("app").style.display = "block";
  iniciarSync();
};

// üîÑ Sincroniza√ß√£o
async function iniciarSync() {
  const snap = await getDoc(lojaRef);
  if (!snap.exists()) {
    await setDoc(lojaRef, {
      produtos: [],
      vendas: [],
      saldoLoja: 0,
      custoTotal: 0,
      lucroTotal: 0
    });
  }

  onSnapshot(lojaRef, s => {
    const d = s.data();
    produtos = d.produtos || [];
    vendas = d.vendas || [];
    saldoLoja = d.saldoLoja || 0;
    custoTotal = d.custoTotal || 0;
    lucroTotal = d.lucroTotal || 0;
    render();
  });
}

async function salvar() {
  await setDoc(lojaRef, { produtos, vendas, saldoLoja, custoTotal, lucroTotal });
}

// ‚ûï Produto
window.addProduto = async () => {
  const nome = nomeInput.value.trim();
  const compra = Number(compraInput.value);
  const venda = Number(vendaInput.value);
  const estoque = Number(estoqueInput.value);

  if (!nome || compra <= 0 || venda <= 0 || estoque < 0) {
    alert("Preencha corretamente");
    return;
  }

  produtos.push({ nome, compra, venda, estoque });
  nomeInput.value = compraInput.value = vendaInput.value = estoqueInput.value = "";
  await salvar();
};

// üí∞ Vender
window.vender = async i => {
  if (produtos[i].estoque <= 0) return alert("Sem estoque");

  produtos[i].estoque--;
  const lucroItem = produtos[i].venda - produtos[i].compra;

  saldoLoja += produtos[i].venda;
  custoTotal += produtos[i].compra;
  lucroTotal += lucroItem;

  vendas.push({
    data: new Date().toLocaleString(),
    nome: produtos[i].nome,
    valorVenda: produtos[i].venda,
    custo: produtos[i].compra,
    lucro: lucroItem,
    produtoIndex: i
  });

  await salvar();
};

// ‚Ü©Ô∏è Estornar
window.estornarVenda = async () => {
  if (!vendas.length) return alert("Nada para estornar");

  const v = vendas.pop();
  produtos[v.produtoIndex].estoque++;
  saldoLoja -= v.valorVenda;
  custoTotal -= v.custo;
  lucroTotal -= v.lucro;

  await salvar();
};

// üóëÔ∏è Remover
window.removerProduto = async i => {
  if (!confirm(`Remover "${produtos[i].nome}"?`)) return;
  produtos.splice(i, 1);
  await salvar();
};

// üñ•Ô∏è Render
function render() {
  lista.innerHTML = "";
  produtos.forEach((p,i)=>{
    lista.innerHTML += `
    <tr>
      <td>${p.nome}</td>
      <td>R$ ${p.compra.toFixed(2)}</td>
      <td>R$ ${p.venda.toFixed(2)}</td>
      <td>${p.estoque}</td>
      <td>
        <button onclick="vender(${i})">Vender</button>
        <button class="remover" onclick="removerProduto(${i})">Remover</button>
      </td>
    </tr>`;
  });

  historico.innerHTML = "";
  vendas.forEach(v=>{
    historico.innerHTML += `
    <tr>
      <td>${v.data}</td>
      <td>${v.nome}</td>
      <td>R$ ${v.valorVenda.toFixed(2)}</td>
      <td>R$ ${v.custo.toFixed(2)}</td>
      <td>R$ ${v.lucro.toFixed(2)}</td>
    </tr>`;
  });

  saldo.innerText = `Saldo da loja: R$ ${saldoLoja.toFixed(2)}`;
  custo.innerText = `Custo total: R$ ${custoTotal.toFixed(2)}`;
  lucro.innerText = `Lucro total: R$ ${lucroTotal.toFixed(2)}`;

  divisao.innerHTML = "";
  const partes=[33,33,16.5,16.5];
  const nomes=["Caixa","Reinvestimento","Bruno","Pedro"];
  partes.forEach((p,i)=>{
    divisao.innerHTML += `<li>${nomes[i]}: R$ ${(lucroTotal*(p/100)).toFixed(2)}</li>`;
  });
}

// Bot√£o
btnAdd.onclick = addProduto;
</script>

</body>
</html>
